
<textarea name="code" class="java" style="display:none;">
MemoryProxy proxy = new MemoryProxy(SampleData.getCompanyData());
RecordDef recordDef = new RecordDef(
		new FieldDef[]{
				new StringFieldDef("company"),
				new FloatFieldDef("price"),
				new FloatFieldDef("change"),
				new FloatFieldDef("pctChange"),
				new DateFieldDef("lastChanged", "n/j h:ia"),
				new StringFieldDef("symbol")
		}
);


ArrayReader reader = new ArrayReader(recordDef);
final Store store = new Store(proxy, reader);
final NumberFormat nf = NumberFormat.getFormat("#,##0.00", "$");
final NumberFormat nfc = NumberFormat.getFormat("#,##0.00");

ColumnModel columnModel = new ColumnModel(new ColumnConfig[]{
		new ColumnConfig() {
			{
				setHeader("Company");
				setWidth(160);
				setSortable(true);
				setDataIndex("company");
			}
		},
		 new ColumnConfig() {
			{
				setHeader("Symbol");
				setWidth(50);
				setSortable(true);
				setDataIndex("symbol");
			}
		},
		new ColumnConfig() {
			{
				setHeader("Price");
				setWidth(75);
				setSortable(true);
				setDataIndex("price");
				setRenderer(new Renderer() {
					public String render(Object value, CellMetadata cellMetadata, Record record, int rowIndex, int colNum, Store store) {
						return nf.format(((Number)value).doubleValue());
					}
				});
			}
		},
		new ColumnConfig() {
			{
				setId("change");
				setHeader("Change");
				setWidth(75);
				setDataIndex("change");
				setRenderer(new Renderer() {
					public String render(Object value, CellMetadata cellMetadata, Record record, int rowIndex, int colNum, Store store) {
						double val = ((Number) value).doubleValue();
						String valString = nfc.format(val);
						if (val < 0) {
							return "<span style='color:red;'>" + valString + "</span>";
						} else {
							return valString;
						}
					}
				});
			}
		},
});

//create and render grid
final Grid grid = new Grid("grid-example-stock", "380px", "300px", store, columnModel);
grid.render();

store.load();

final Record[] records = store.getRecords();

final Timer t = new Timer() {
	public void run() {
		for (int i = 0; i < 10; i++) {
			Record rec = records[getRandomInRange(records.length)];
			double oldPrice = rec.getAsDouble("price");
			boolean add = Math.random() > 0.5;
			double delta = Math.random();
			double newPrice = add? oldPrice + delta : oldPrice - delta;
			rec.set("price", newPrice);
			rec.set("change", add ? delta : -1*delta);
			store.commitChanges();
		}
	}
};

Button startButton = new Button(new ButtonConfig() {
	{
		setText("Start updates");
		setButtonListener(new ButtonListenerAdapter() {
			public void onClick(Button button, EventObject e) {
				t.scheduleRepeating(1000);
			}
		});
	}
});

Button stopButton = new Button(new ButtonConfig() {
	{
		setText("Stop updates");
		setButtonListener(new ButtonListenerAdapter() {
			public void onClick(Button button, EventObject e) {
				t.cancel();
			}
		});
	}
});
       
</textarea>


<script class="javascript">
    dp.SyntaxHighlighter.HighlightAll('code');
</script>
